# ====== パス ======
M4_MODELS_DIR="/Users/horioshuuhei/m4-meet-models"
M4_DIAR_DIR="/Users/horioshuuhei/m4-meet-models/diar"
LOG_DIR=backend/data

# ====== API/WS ======
PORT_BACKEND=8001
PORT_FRONTEND=5173
VITE_API_BASE=http://127.0.0.1:8001
VITE_WS_BASE=ws://127.0.0.1:8001

# ====== LLM ======
M4_LLM_PROVIDER=ollama
M4_OLLAMA_BASE=http://127.0.0.1:11434
M4_OLLAMA_MODEL=qwen2.5:7b-instruct
M4_OLLAMA_TEMPERATURE=0.3
M4_OLLAMA_MAX_TOKENS=768
M4_OLLAMA_TIMEOUT=180

# ======================================================
#  ASR：ライブ=SenseVoice（Streaming） / バッチ=Whisper
# ======================================================
M4_ASR_KIND=sensevoice
M4_ASR_PROVIDER=cpu
M4_ASR_LIVE=1

# SenseVoice (ONNX INT8)
M4_ASR_DIR="/Users/horioshuuhei/m4-meet-models/sensevoice"
M4_ASR_TOKENS="/Users/horioshuuhei/m4-meet-models/sensevoice/tokens.txt"
M4_ASR_MODEL="/Users/horioshuuhei/m4-meet-models/sensevoice/model.int8.onnx"

# --- ライブ解析ウィンドウ（Whisper互換 20ms送出前提）---
STREAM_WIN_MS=960            # 0.96s デコード窓
STREAM_HOP_MS=240            # 0.24s ホップ

# 無音ギャップ確定（EoS来なくても素早く確定）
TURN_GAP_S=0.55
MIN_TURN_SEC=0.45
MIN_TURN_CHARS=6

# ====== 入口ゲート/VAD（まず確実に出す） ======
M4_VAD_ENGINE=energy
M4_NEAR_SILENT_PEAK=0
M4_NEAR_SILENT_RMS=0.0012
VAD_PREROLL_MS=300           # 語頭欠け対策（慣れたら 240へ）

# 連続発話の尾切れ抑制
M4_VAD_MIN_SPEECH_MS=120
M4_VAD_HANG_MS=400

# ライブ表示：旧partialはためず、サーバの確定を上書き
WS_PARTIAL_MODE=off
# 同一文の直後重複を抑止
RECENT_FINAL_WINDOW_S=6.0

# ======================================================
#  停止後の高精度再整形（faster-whisper 直呼び想定）
# ======================================================
M4_BATCH_WHISPER=on
M4_WHISPER_MODEL=large-v3
M4_WHISPER_DEVICE=auto
M4_WHISPER_COMPUTE=int8       # 余力があれば float16 へ
M4_WHISPER_BEAM=5
M4_WHISPER_THREADS=4
M4_INITIAL_PROMPT_FILE="/Users/horioshuuhei/m4-meet-models/prompts/ja_init.txt"

# Whisper 側フィルタ（まず出す→後で絞る）
FW_MIN_LOGPROB=-0.80
JP_RATIO_MIN=0.50
M4_AUTOFILL_MINUTES=off

# ====== バッチ ======
M4_BATCH_TRANSLATE=off
M4_BATCH_SUMMARY=on

# ====== 話者分離は一旦OFF（pyannote依存を避ける）=====
M4_ENABLE_DIAR_LIVE=off
M4_ENABLE_DIAR_BATCH=off
M4_DIAR_ENGINE=pyannote
DIAR_MIN_TURN_SEC=0.60
DIAR_OVERLAP=off
