# ====== PATHS / SERVER ======
M4_MODELS_DIR="/Users/horioshuuhei/m4-meet-models"
M4_DIAR_DIR="/Users/horioshuuhei/m4-meet-models/diar"
LOG_DIR=backend/data
PORT_BACKEND=8001
PORT_FRONTEND=5173
VITE_API_BASE=
VITE_WS_BASE=

# ====== ASR: SenseVoice (Offline) ======
M4_ASR_KIND=sense-voice-offline
M4_ASR_LIVE=1
M4_ASR_DIR="/Users/horioshuuhei/m4-meet-models/sensevoice"
M4_ASR_TOKENS="/Users/horioshuuhei/m4-meet-models/sensevoice/tokens.txt"
M4_ASR_MODEL="/Users/horioshuuhei/m4-meet-models/sensevoice/model.int8.onnx"

# ====== VAD（適応しきい + プレロール + ブリッジ + ハングオーバー + テイル繰越） ======
# ベース（後方互換）
M4_VAD_ENGINE=energy
M4_NEAR_SILENT_RMS=0.0012
M4_NEAR_SILENT_PEAK=8000
VAD_PREROLL_MS=200

# 新・適応VAD（コードが M4_* を読む想定。互換のため VAD_* も併記）
M4_VAD_ADAPTIVE=on
M4_NOISE_CAL_SEC=0.80
M4_TH_START_MUL=4.2
M4_TH_STOP_MUL=3.0
M4_TH_MIN=0.0015
M4_TH_MAX=0.0200
M4_PREPAD_SEC=0.20
M4_TAIL_CARRY_SEC=0.30
M4_HANG_START_FR=3
M4_HANG_STOP_FR=16
M4_BRIDGE_GAP_SEC=0.28
# 互換エイリアス（実装が VAD_* を読む場合用）
VAD_NOISE_CAL_SEC=0.80
VAD_TH_START_MUL=4.2
VAD_TH_STOP_MUL=3.0
VAD_TH_MIN=0.0015
VAD_TH_MAX=0.0200
VAD_HANG_START_FR=3
VAD_HANG_STOP_FR=16
VAD_BRIDGE_GAP_SEC=0.28
VAD_TAIL_CARRY_SEC=0.30

# ASR 安定化
MIN_TURN_SEC=0.70
MIN_TURN_CHARS=6
WS_PARTIAL_MODE=off
RECENT_FINAL_WINDOW_S=6.0
M4_MIN_ASR_SEC=1.20
MIN_ASR_SEC=1.20   # ← 後方互換のため残し

# ====== ライブ話者分離（可変K・短発話stick・margin/蓄積） ======
M4_DIAR_MODE=auto         # auto / fixed2 / fixedK
M4_DIAR_MAX_K=3           # 可変Kの上限
M4_DIAR_K_MAX=3           # 互換エイリアス（どちらでも同値）
M4_DIAR_BOOT_SEC=35       # 起動直後だけK推定
M4_DIAR_FREEZE_SEC=8      # ブート直後は新規SPK抑止

# 短発話＆切替条件
M4_DIAR_MIN_SHORT_SEC=0.40
M4_DIAR_MIN_SWITCH_SEC=0.60
M4_DIAR_SHORT_ALT=0.72
M4_DIAR_SHORT_DELTA=0.08

# 通常切替・曖昧帯
M4_DIAR_SIM_BASE=0.74
M4_DIAR_DELTA_SWITCH=0.03
M4_DIAR_SOFT_MIN=0.62     # ← タイポ修正（SOFTWARE_MIN → SOFT_MIN）
M4_DIAR_STICKY_SEC=3.0

# margin / 蓄積スイッチ
M4_DIAR_MARGIN_STRONG=0.10
M4_DIAR_WEAK_MARGIN=0.05
M4_DIAR_OPP_STREAK_N=2
M4_DIAR_OPP_STREAK_SEC=1.0

# --- intraseg: 長時間の声質乗っ取り検知 ---
M4_DIAR_LONG_SWITCH_SEC=1.8
M4_DIAR_LONG_ALT_SIM=0.68
M4_DIAR_LONG_ALT_MARGIN=0.02
M4_DIAR_MIN_SENT_FOR_INTRASPLIT=1.40
M4_DIAR_INTRASPLIT_BACKTRACE_SEC=0.45
M4_DIAR_INTRASPLIT_COOLDOWN_SEC=2.5

# 埋め込み・クラスタ関連
M4_DIAR_ENGINE=speechbrain
M4_DIAR_EMB_WIN_S=1.2
M4_DIAR_EMB_HOP_S=0.6
M4_DIAR_AHC_DIST_THR=0.82
M4_DIAR_NEW_SPK_MIN_SEC=2.4
M4_DIAR_NEW_SPK_COOLDOWN_SEC=6
M4_DIAR_REASSIGN_BACKTRACE_SEC=4.0
M4_DIAR_PRUNE_SEC=3.0

# ====== 停止後: Whisper再転記 / 要約 ======
M4_BATCH_WHISPER=on
M4_WHISPER_MODEL=large-v3
M4_WHISPER_DEVICE=auto
M4_WHISPER_COMPUTE=int8
M4_WHISPER_BEAM=5
M4_WHISPER_THREADS=4
M4_INITIAL_PROMPT_FILE="/Users/horioshuuhei/m4-meet-models/prompts/ja_init.txt"
M4_BATCH_SUMMARY=on
M4_BATCH_TRANSLATE=off
M4_MT_KIND=off
M4_CT2_DIR=

# ====== LLM (Ollama) ======
M4_LLM_PROVIDER=ollama
M4_OLLAMA_BASE=http://127.0.0.1:11434
M4_OLLAMA_MODEL=qwen2.5:7b-instruct
M4_OLLAMA_TEMPERATURE=0.3
M4_OLLAMA_MAX_TOKENS=768
M4_OLLAMA_TIMEOUT=180
